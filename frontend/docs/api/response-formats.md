# API Response Formats

This document provides detailed information about the request and response formats for the Chat UI API.

## Chat API

### Request Format (Both Modes)

Both standard and multi-agent chat modes use the same request format:

```json
{
  "messages": [
    {
      "role": "user",
      "content": "Hello, how are you?"
    },
    {
      "role": "assistant",
      "content": "I'm doing well, thank you. How can I help you today?"
    },
    {
      "role": "user",
      "content": "Can you help me with..."
    }
  ]
}
```

The request contains the entire conversation history, with the most recent message at the end of the array.

### Response Format

Both standard and multi-agent chat modes should use a standardized response format that focuses on the essential information needed by the UI:

#### Standard Response (Single Message)

```json
{
  "messageId": "unique-message-identifier-123",
  "conversationId": "conversation-identifier-abc",
  "status": "completed",
  "role": "assistant",
  "content": "This is the text response generated by the AI.",
  "contentType": "text",
  "sources": [],
  "error": null,
  "createdAt": "2023-04-03T16:38:35.123Z"
}
```

#### Multi-Agent Response (Array of Messages)

```json
[
  {
    "messageId": "unique-message-identifier-123",
    "conversationId": "conversation-identifier-abc",
    "status": "completed", 
    "role": "assistant",
    "content": "This is a response from the Research agent.",
    "contentType": "text",
    "agentName": "Research",
    "sources": [
      {
        "id": "source-doc-id-1",
        "title": "Research Paper Title",
        "url": "https://example.com/research-paper",
        "snippet": "Relevant text snippet from the source..."
      }
    ],
    "error": null,
    "createdAt": "2023-04-03T16:38:35.123Z"
  },
  {
    "messageId": "unique-message-identifier-456",
    "conversationId": "conversation-identifier-abc",
    "status": "completed",
    "role": "assistant",
    "content": "Based on the research, here's how you might implement this feature.",
    "contentType": "markdown",
    "agentName": "Code",
    "sources": [],
    "error": null,
    "createdAt": "2023-04-03T16:38:40.456Z"
  }
]
```

### Field Descriptions

| Field | Type | Required | Description |
|:------|:-----|:---------|:------------|
| `messageId` | String | Required | A unique identifier for this specific message instance. Needed for tracking messages, updating them (during streaming), and managing message lists. |
| `conversationId` | String | Optional | An identifier for the conversation thread. Useful for grouping messages or fetching history. |
| `status` | String | Required | The current state of message generation: `processing`, `completed`, or `failed`. |
| `role` | String | Required | Indicates who generated the message. Typically `assistant` for AI responses. |
| `content` | String | Required | The actual textual content of the message. May be partial if status is `processing`. |
| `contentType` | String | Required | Format of the content: `text` or `markdown`. | 
| `agentName` | String | Optional | For multi-agent mode only. The name/identifier of the agent that generated this message. |
| `sources` | Array | Optional | Citation information if the AI response was based on specific retrieved documents. |
| `error` | Object | Required | Null if successful. Contains at least a `message` field if status is `failed`. |
| `createdAt` | String | Required | ISO 8601 timestamp indicating when the message was generated. |

### Status Values

- `processing`: The response is still being generated (streaming). The content field contains partial data.
- `completed`: The response generation is finished successfully. The content field contains the final message.
- `failed`: An error occurred. The error field contains details.

### Sources Object Structure

Each object in the `sources` array should contain:

```json
{
  "id": "source-doc-id-1",
  "title": "Source Document Title",
  "url": "https://example.com/optional-source-link",
  "snippet": "Optional relevant text snippet from the source..."
}
```

### Error Object Structure

When `status` is `failed`, the `error` object should contain at least:

```json
{
  "message": "User-friendly error description",
  "code": "ERROR_CODE" 
}
```

## Streaming Responses

For streaming responses, the API should send partial updates with the same `messageId` but different content as generation progresses:

### Streaming Response Example

Initial chunk:
```json
{
  "messageId": "unique-message-identifier-123",
  "conversationId": "conversation-identifier-abc",
  "status": "processing",
  "role": "assistant",
  "content": "I'm analyzing your question",
  "contentType": "text",
  "sources": [],
  "error": null,
  "createdAt": "2023-04-03T16:38:35.123Z"
}
```

Subsequent chunk:
```json
{
  "messageId": "unique-message-identifier-123",
  "conversationId": "conversation-identifier-abc",
  "status": "processing",
  "role": "assistant",
  "content": "I'm analyzing your question about quantum computing",
  "contentType": "text",
  "sources": [],
  "error": null,
  "createdAt": "2023-04-03T16:38:36.456Z"
}
```

Final chunk:
```json
{
  "messageId": "unique-message-identifier-123",
  "conversationId": "conversation-identifier-abc",
  "status": "completed",
  "role": "assistant",
  "content": "I'm analyzing your question about quantum computing. Quantum computers use quantum bits (qubits) that can represent both 0 and 1 simultaneously...",
  "contentType": "text",
  "sources": [
    {
      "id": "source-123",
      "title": "Introduction to Quantum Computing",
      "url": "https://example.com/quantum",
      "snippet": "Quantum computers use quantum bits (qubits) that can represent both 0 and 1 simultaneously."
    }
  ],
  "error": null,
  "createdAt": "2023-04-03T16:38:40.789Z"
}
```

## Server-Sent Events (SSE) Format

For Server-Sent Events streaming, each event should be formatted as:

```
data: {"messageId":"unique-message-identifier-123","status":"processing","role":"assistant","content":"Partial content...","contentType":"text","sources":[],"error":null,"createdAt":"2023-04-03T16:38:35.123Z"}

data: {"messageId":"unique-message-identifier-123","status":"completed","role":"assistant","content":"Complete content...","contentType":"text","sources":[],"error":null,"createdAt":"2023-04-03T16:38:40.789Z"}
```

## History API

The application can also communicate with a history API for managing chat histories.

### Get Chat Histories

**Request:** `GET /chat-history?mode=standard` or `GET /chat-history?mode=multiAgent`

**Response:**

```json
[
  {
    "id": "chat-123",
    "title": "API Discussion",
    "lastMessage": "Here's the API endpoint...",
    "lastUpdated": "2023-04-05T14:48:00.000Z",
    "messageCount": 12
  },
  {
    "id": "chat-124",
    "title": "Project Planning",
    "lastMessage": "Let's start with the architecture...",
    "lastUpdated": "2023-04-06T10:15:00.000Z",
    "messageCount": 8
  }
]
```

### Get Chat Messages

**Request:** `GET /chat-history/{chatId}/messages`

**Response:**

```json
[
  {
    "messageId": "msg-123",
    "conversationId": "chat-123",
    "status": "completed",
    "role": "user",
    "content": "Hello, I need help with...",
    "contentType": "text",
    "sources": [],
    "error": null,
    "createdAt": "2023-04-07T10:15:00.000Z"
  },
  {
    "messageId": "msg-124",
    "conversationId": "chat-123",
    "status": "completed",
    "role": "assistant",
    "content": "I'll help you with that...",
    "contentType": "text",
    "agentName": "Technical",
    "sources": [],
    "error": null,
    "createdAt": "2023-04-07T10:16:00.000Z"
  }
]
```

### Create New Chat

**Request:** `POST /chat-history`

**Payload:**
```json
{
  "mode": "standard",
  "title": "New Chat"
}
```

**Response:**
```json
{
  "id": "chat-125",
  "title": "New Chat",
  "lastUpdated": "2023-04-07T09:00:00.000Z",
  "messageCount": 0
}
```

### Update Chat

**Request:** `PUT /chat-history/{chatId}/messages`

**Payload:**
```json
{
  "messages": [
    {
      "messageId": "msg-125",
      "conversationId": "chat-123",
      "status": "completed",
      "role": "user",
      "content": "Can you explain how to use the API?",
      "contentType": "text",
      "sources": [],
      "error": null,
      "createdAt": "2023-04-07T11:30:00.000Z"
    },
    {
      "messageId": "msg-126",
      "conversationId": "chat-123",
      "status": "completed",
      "role": "assistant",
      "content": "Sure, the API has two main endpoints...",
      "contentType": "text",
      "sources": [],
      "error": null,
      "createdAt": "2023-04-07T11:31:00.000Z"
    }
  ]
}
```

**Response:**
```json
{
  "id": "chat-123",
  "title": "API Discussion",
  "lastMessage": "Sure, the API has two main endpoints...",
  "lastUpdated": "2023-04-07T11:31:00.000Z",
  "messageCount": 14
}
```

### Delete Chat

**Request:** `DELETE /chat-history/{chatId}`

**Response:**
```json
{
  "success": true
}
```

## Minimal Response Format

While the complete format described above is recommended for full functionality, the Chat UI can work with a simplified format. Here is the absolute minimal format required:

```json
[
  {
    "Items": [
      {
        "Text": "Your response text here"
      }
    ]
  }
]
```

This minimal format must:
1. Be an array containing at least one object
2. Each object must have an `Items` array
3. Each item in `Items` must have a `Text` field with the response content

The field `$type` is optional - if present, it should be "TextContent" for text responses.

### Implementation Examples

#### C# Minimal Implementation

```csharp
using System;
using System.Collections.Generic;
using System.Text.Json;
using Microsoft.AspNetCore.Mvc;

[ApiController]
[Route("api")]
public class ChatController : ControllerBase
{
    [HttpPost("chat")]
    public IActionResult Chat([FromBody] object request)
    {
        var response = new List<object>
        {
            new
            {
                Items = new List<object>
                {
                    new
                    {
                        Text = "This is the response from the C# API."
                    }
                }
            }
        };
        
        return Ok(response);
    }
}
```

#### Java Minimal Implementation

```java
import org.springframework.web.bind.annotation.*;
import java.util.*;

@RestController
@RequestMapping("/api")
public class ChatController {

    @PostMapping("/chat")
    public List<Map<String, Object>> chat(@RequestBody Map<String, Object> request) {
        List<Map<String, Object>> response = new ArrayList<>();
        
        Map<String, Object> messageObj = new HashMap<>();
        List<Map<String, Object>> items = new ArrayList<>();
        
        Map<String, Object> textItem = new HashMap<>();
        textItem.put("Text", "This is the response from the Java API.");
        
        items.add(textItem);
        messageObj.put("Items", items);
        response.add(messageObj);
        
        return response;
    }
}
```

#### Python Minimal Implementation

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/api/chat', methods=['POST'])
def chat():
    request_data = request.get_json()
    
    response = [
        {
            "Items": [
                {
                    "Text": "This is the response from the Python API."
                }
            ]
        }
    ]
    
    return jsonify(response)

if __name__ == '__main__':
    app.run(debug=True)
```

Note: While this minimal format will work with the current implementation, it's recommended to use the complete format for better compatibility with future updates and to support all features of the Chat UI.

## Implementation Examples

For implementation examples in various languages, see:

- [C# Implementation](./examples/csharp.md)
- [Java Implementation](./examples/java.md)
- [Python Implementation](./examples/python.md) 